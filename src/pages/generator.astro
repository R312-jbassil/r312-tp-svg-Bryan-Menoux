---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div class="flex flex-col gap-6 bg-base-200 min-h-screen p-6">
    <div class="flex flex-col lg:flex-row flex-1 gap-6">
      <div
        id="svg-container"
        class="flex-1 bg-base-100 rounded-2xl border-2 border-violet-500 flex items-center justify-center"
      >
        <span class="text-zinc-400">En attente...</span>
      </div>

      <div
        class="flex-1 bg-base-100 rounded-2xl border-2 border-violet-500 overflow-hidden"
      >
        <div class="mockup-window border bg-base-300 h-full">
          <pre
            id="svg-output"
            class="p-4 text-sm text-zinc-100 bg-zinc-900 h-full w-full overflow-y-auto whitespace-pre-wrap break-words">
          </pre>
        </div>
      </div>
    </div>

    <div
      class="flex gap-2 bg-base-100 rounded-2xl p-2 border-2 border-violet-500"
    >
      <input
        id="user-prompt"
        type="text"
        placeholder="Décrivez votre SVG..."
        class="input input-bordered flex-1"
      />
      <button id="generate-button" class="btn btn-primary">Générer</button>
    </div>
  </div>
</Layout>

<script>
  //@ts-nocheck
  async function generateSVG(prompt) {
    const res = await fetch("/api/generateSVG", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt }),
    });
    return (await res.json()).svg;
  }

  async function handleSubmit() {
    const input = document.getElementById("user-prompt");
    const svgContainer = document.getElementById("svg-container");
    const svgOutput = document.getElementById("svg-output");
    const generateButton = document.getElementById("generate-button");

    const prompt = input.value.trim();
    if (!prompt) return;

    svgContainer.innerHTML = `<span class="loading loading-ring loading-xl text-violet-500"></span>`;
    svgOutput.textContent = "";
    generateButton.disabled = true;

    try {
      const svg = await generateSVG(prompt);
      svgContainer.innerHTML =
        svg || `<span class="text-zinc-400">Aucun SVG</span>`;
      svgOutput.textContent = svg;
    } finally {
      generateButton.disabled = false;
    }
  }

  const generateButton = document.getElementById("generate-button");
  const input = document.getElementById("user-prompt");
  generateButton.addEventListener("click", handleSubmit);
  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") handleSubmit();
    input.value = "";
  });
</script>
